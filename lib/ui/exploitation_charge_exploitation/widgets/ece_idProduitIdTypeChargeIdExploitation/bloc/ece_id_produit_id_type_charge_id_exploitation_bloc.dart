import 'package:bloc/bloc.dart';
import 'package:equatable/equatable.dart';
import 'package:ges_op/datas/repositories/repository/exploitaion_charge_exploitation_repository.dart';

import '../../../../../models/models.dart';

part 'ece_id_produit_id_type_charge_id_exploitation_event.dart';
part 'ece_id_produit_id_type_charge_id_exploitation_state.dart';

class EceIdProduitIdTypeChargeIdExploitationBloc extends Bloc<
    EceIdProduitIdTypeChargeIdExploitationEvent,
    EceIdProduitIdTypeChargeIdExploitationState> {
  EceIdProduitIdTypeChargeIdExploitationBloc({
    required this.exploitationChargeExploitationRepository,
  }) : super(const EceIdProduitIdTypeChargeIdExploitationState()) {
    on<GenerateEceIdProduitIdTypeChargeIdExploitationEvent>(
        _mapGetExploitationsFiltersEventToState);
  }

  final ExploitationChargeExploitationRepository
      exploitationChargeExploitationRepository;

  void _mapGetExploitationsFiltersEventToState(
      GenerateEceIdProduitIdTypeChargeIdExploitationEvent event,
      Emitter<EceIdProduitIdTypeChargeIdExploitationState> emit) async {
    try {
      emit(state.copyWith(
          status: EceIdProduitIdTypeChargeIdExploitationStatus.loading));
      print('-------LODING ECE --------');

      final retourExploitationChargeExploitations =
          await exploitationChargeExploitationRepository
              .getECEidProduitidTypeChargeBox(event.idProduit,
                  event.idTypeChargeExploitation, event.idExploitation);
      emit(
        state.copyWith(
            status: EceIdProduitIdTypeChargeIdExploitationStatus.success,
            exploitationChargeExploitations:
                retourExploitationChargeExploitations,
            idProduit: event.idProduit,
            idTypeChargeExploitation: event.idTypeChargeExploitation,
            idExploitation: event.idExploitation),
      );
      print('-------SUCCESS ECE --------');
    } catch (error, stacktrace) {
      print(stacktrace);
      emit(state.copyWith(
          status: EceIdProduitIdTypeChargeIdExploitationStatus.error));
      print('-------ERROR ECE --------');
    }
  }
}
