import 'package:dropdown_pro/dropdown.dart';
import 'package:dropdown_pro/dropdown_item.dart';
import 'package:flutter/material.dart';
import 'package:flutter/src/widgets/container.dart';
import 'package:flutter/src/widgets/framework.dart';
import 'package:flutter_bloc/flutter_bloc.dart';

import '../../../../features/features.dart';
import '../../../../models/models.dart';
import '../../../variete/widgets/all_variete_widget/bloc/all_varietes_bloc.dart';
import '../exploitations_widget/bloc/exploitation_bloc.dart';

class VarieteMultiFilter extends StatelessWidget {
  const VarieteMultiFilter({super.key});

  @override
  Widget build(BuildContext context) {
    List<DropdownItem> _itemVarietesList = [];
    String _singleSelectedVarieteId = "";
    final List<String> _mutiSelectedVarietesIds = [];

    _onLoginButtonPressed() {
      BlocProvider.of<ExploitationBloc>(context).add(
        LoadExploitationEvent(
            compte: ApiConstants.compte,
            listStringVarieteId: ApiConstants.listStringVarieteId,
            listStringAnneeId: ApiConstants.listStringAnneeId),
      );
    }

    return BlocBuilder<AllVarietesBloc, AllVarietesState>(
        builder: (context, stateVariete) {
      List<DropdownItem> list = [];
      var mesVarietes = stateVariete.varietes;
      for (var element in mesVarietes) {
        print(element.name);
        list.add(DropdownItem(
            id: element.id.toString(),
            value: element.produit_name.toString().toUpperCase() +
                ' | ' +
                element.name.toString().toUpperCase(),
            data: VarieteObject(
              id: element.id,
              name: element.name,
              surface_unite: element.surface_unite,
              quantite_unite: element.quantite_unite,
              rendement_unite: element.rendement_unite,
              produit_id: element.produit_id,
              produit_name: element.produit_name,
              filiere_id: element.filiere_id,
              filiere_name: element.filiere_name,
              familleemplacement_id: element.familleemplacement_id,
              familleemplacement_name: element.familleemplacement_name,
            )));
      }

      _itemVarietesList = list;

      return Column(
        children: [
          Dropdown.multiSelection(
              title: "CHOISIR VARIETES",
              labelText: "MULTI-VARIETES",
              hintText: "Selection varietes",
              list: _itemVarietesList,
              selectedIds: _mutiSelectedVarietesIds,
              isAllSelection: true,
              onMultipleItemListener: (selectedItemList) {
                for (DropdownItem selectedItem in selectedItemList) {
                  String itemId = selectedItem.id;
                  String itemName = selectedItem.value;
                  VarieteObject varieteObject =
                      selectedItem.data as VarieteObject;
                  //print("Item Id: $itemId -- Item Name: $itemName }");
                }

                ApiConstants.listStringVarieteId = _mutiSelectedVarietesIds;
                _onLoginButtonPressed();

                for (int i = 0; i < _mutiSelectedVarietesIds.length; i++) {
                  print('-----${_mutiSelectedVarietesIds[i].toString()} ----');
                }
              }),
        ],
      );
    });
  }
}
