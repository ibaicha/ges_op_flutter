import 'package:dropdown_pro/dropdown.dart';
import 'package:dropdown_pro/dropdown_item.dart';
import 'package:flutter/material.dart';
import 'package:flutter/src/widgets/container.dart';
import 'package:flutter/src/widgets/framework.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:ges_op/ui/annee/widgets/all_annees_widget/bloc/all_annees_bloc.dart';
import 'package:ges_op/ui/exploitation/widgets/exploitations_widget/bloc/exploitation_bloc.dart';
 

import '../../../../features/features.dart';
import '../../../../models/models.dart';
import '../../../variete/widgets/all_variete_widget/bloc/all_varietes_bloc.dart';


class VarieteFilter extends StatelessWidget {
  const VarieteFilter({super.key});
  

  @override
  Widget build(BuildContext context) {
    List<DropdownItem> _itemVarietesList = [];
    String _singleSelectedVarieteId = "";

    _onLoginButtonPressed() {
      BlocProvider.of<ExploitationBloc>(context)
          .add(LoadExploitationEvent(
              compte: ApiConstants.compte,
              listStringVarieteId: ApiConstants.listStringVarieteId,
              listStringAnneeId: ApiConstants.listStringAnneeId));
    }

    return BlocBuilder<AllVarietesBloc, AllVarietesState>(
        builder: (context, stateVariete) {
      List<DropdownItem> list = [];

      list.add(DropdownItem(
          id: '',
          value: 'Choix Variété',
          data: VarieteObject(
            id: 0,
            name: '',
            surface_unite: '',
            quantite_unite: '',
            rendement_unite: 0,
            produit_id: 0,
            produit_name: '',
            filiere_id: 0,
            filiere_name: '',
            familleemplacement_id: 0,
            familleemplacement_name: '',
          )));
      var mesVarietes = stateVariete.varietes;
      for (var element in mesVarietes) {
        print(element.name);
        list.add(DropdownItem(
            id: element.id.toString(),
            value: element.produit_name.toString().toUpperCase() +
                ' | ' +
                element.name.toString().toUpperCase(),
            data: VarieteObject(
              id: element.id,
              name: element.name,
              surface_unite: element.surface_unite,
              quantite_unite: element.quantite_unite,
              rendement_unite: element.rendement_unite,
              produit_id: element.produit_id,
              produit_name: element.produit_name,
              filiere_id: element.filiere_id,
              filiere_name: element.filiere_name,
              familleemplacement_id: element.familleemplacement_id,
              familleemplacement_name: element.familleemplacement_name,
            )));
      }

      _itemVarietesList = list;

      return Column(
        children: [
          Dropdown.singleSelection(
              title: "CHOISIR UNE VARIETE",
              labelText: "VARIETE",
              hintText: "Selection variete",
              list: _itemVarietesList,
              selectedId: _singleSelectedVarieteId,
              onSingleItemListener: (selectedItem) {
                ApiConstants.singleSelectedVarieteId = selectedItem.id;
                String itemId = selectedItem.id;
                String itemName = selectedItem.value;
                VarieteObject varieteObject =
                    selectedItem.data as VarieteObject;
                _onLoginButtonPressed();
                print(
                    "Item Id: $itemId -- Item Name: $itemName ## Other Details ## Variete Id: ${varieteObject.id} -- Variete valeur: ${varieteObject.produit_name}");
              }),
        ],
      );
    });

    
  }
}
